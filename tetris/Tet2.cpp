//---------------------------------------------------------------------------

#include <vcl.h>
#include <conio.h>
#include <iostream.h>
#pragma hdrstop

//---------------------------------------------------------------------------

#pragma argsused




void FPrint(bool a[10][12],int s)
{
char w;
clrscr();
for(int i=0;i<12;i++)
		{w=179;
		cout<<" "<<w<<" ";
		for(int j=0;j<10;j++)
        {

        if(a[j][i]==1)
		{w=201;
        cout<<w;
        w=205;
        cout<<w;
        w=187;
        cout<<w;}
      
        else if(a[j][i]==0) cout<<"   ";

        }w=179;
        cout<<" "<<w<<"  ";
        cout<<endl;

        w=179;
        cout<<" "<<w<<" ";

       /* for(int j=0;j<9;j++)
        {

        if(a[j][i]==1)

        {w=179;
        cout<<w;
        cout<<" ";
        w=179;
        cout<<w;}

        else if(a[j][i]==0) cout<<"   ";

        }cout<<endl;
        cout<<"     ";*/

        for(int j=0;j<10;j++)
        {if(a[j][i]==1)
        {w=200;
        cout<<w;
        w=205;
        cout<<w;
        w=188;
        cout<<w;
        }
        else if(a[j][i]==0) cout<<"   ";

        }        w=179;
        cout<<" "<<w;
        cout<<endl;//cout<<"     ";



        }
        w=192;
        cout<<" "<<w;
        w=196;
        for(int i=0;i<32;i++)
        cout<<w;
        w=217;
        cout<<w;
        cout<<endl;
        cout<<"       "<<"SCORE"<<s;




};





int main(int argc, char* argv[])
{
int r,q=0,w=0,z[4]={0,0,0,0},x[4]={0,0,0,0},t=0,z1,x1,s=1,st=0,sum=0,fnam;
bool a[10][12];
bool aOld[10][12];
bool b=0,yk, Refresh = true;
//SetTimer(NULL,0,1000,NULL);GetMessage(&Msg,NULL,0,0);

/*char p;
for(int y=1;y<256;y++)
cout<<y<<(p=y)<<"  ";
getch();
int c;
c=getch();
cout<<c;
getch();
*/
randomize();


for(int i=0;i<10;i++)
		for(int j=0;j<12;j++)
				{a[i][j]=0; aOld[i][j]=0;}

FPrint(a,s);

 while(w==0)
 {
		if(b==0)
        {
                fnam=random(6)+1;



       switch(fnam)
        {
        case 1:
        {
        z[0]=3; z[1]=3; z[2]=4; z[3]=5;
        x[0]=0; x[1]=1; x[2]=1; x[3]=1;
        b=1;z1=1;x1=1;s=0;break;
        }
        case 2:
        {
        z[0]=5; z[1]=5; z[2]=4; z[3]=3;
        x[0]=0; x[1]=1; x[2]=1; x[3]=1;
        b=1;z1=2;x1=1;s=0;break;
        }
        case 3:
        {
        z[0]=3; z[1]=4; z[2]=4; z[3]=5;
        x[0]=0; x[1]=0; x[2]=1; x[3]=1;
        b=1;z1=3;x1=1;s=0;break;
        }
        case 4:
        {
        z[0]=3; z[1]=4; z[2]=4; z[3]=5;
        x[0]=1; x[1]=1; x[2]=0; x[3]=0;
        b=1;z1=4;x1=1;s=0;break;
        }
        case 5:
        {
        z[0]=4; z[1]=5; z[2]=4; z[3]=5;
        x[0]=1; x[1]=1; x[2]=0; x[3]=0;
        b=1;z1=5;x1=1;s=0;break;
        }
        case 6:
        {
        z[0]=3; z[1]=4; z[2]=5; z[3]=6;
        x[0]=0; x[1]=0; x[2]=0; x[3]=0;
        b=1;z1=6;x1=1;s=0;break;
        }



        }    





        }

 //clrscr();

 for(int i=0;i<4;i++)
		{a[z[i]][x[i]]=1;}

	Refresh = false;
	for(int i=0;i<10;i++)
		for(int j=0;j<12;j++)
			{if(aOld[i][j] != a[i][j]) {Refresh = true; break;}}

	if(Refresh)
	{
		FPrint(a,sum);
		for(int i=0;i<10;i++)
			for(int j=0;j<12;j++)
				{aOld[i][j] = a[i][j];}
	}

 Sleep(100);
 t++;
 r=kbhit();
 if(r!=0)
 {
 q=getch();

 switch (q)
 {
 case 77:{
       /* if(z[0]!=9&&z[3]!=9)
                if(a[z[0]+1][x[0]]!=1    ^z[0]+1==z[1])
                        if(a[z[1]+1][x[1]]!=1    ^z[1]+1==z[2]^z[1]+1==z[0])
                                if(a[z[2]+1][x[2]]!=1    ^z[2]+1==z[1]^z[2]+1==z[3])
                                        if(a[z[3]+1][x[3]]!=1    ^z[3]+1==z[2])  */
                                           
if(z[0]!=9&&z[3]!=9&&z[1]!=9&&z[2]!=9)
        if(a[z[0]+1][x[0]]!=1 || (z[0]<z[1]&&x[0]==x[1]) || (z[0]<z[2]&&x[0]==x[2]) || (z[0]<z[3]&&x[0]==x[3]))
                if(a[z[1]+1][x[1]]!=1||(z[1]<z[0]&&x[1]==x[0]) || (z[1]<z[2]&&x[1]==x[2]) || (z[1]<z[3]&&x[1]==x[3]))
                        if(a[z[2]+1][x[2]]!=1||(z[2]<z[0]&&x[2]==x[0]) || (z[2]<z[1]&&x[2]==x[1]) || (z[2]<z[3]&&x[2]==x[3]))
                                if(a[z[3]+1][x[3]]!=1||(z[3]<z[0]&&x[3]==x[0]) || (z[3]<z[1]&&x[3]==x[1]) || (z[3]<z[2]&&x[3]==x[2]))



		{
        for(int i=0;i<4;i++)a[z[i]][x[i]]=0;
        z[0]+=1; z[1]+=1; z[2]+=1; z[3]+=1;
        for(int i=0;i<4;i++)a[z[i]][x[i]]=1;
	//FPrint(a,sum);
	}break;
        }
 case 75:{
        /*if(z[0]!=0&z[3]!=0)
                if(a[z[0]-1][x[0]]!=1    ^z[0]-1==z[1])
                        if(a[z[1]-1][x[1]]!=1    ^z[1]-1==z[2]^z[1]-1==z[0])
                                if(a[z[2]-1][x[2]]!=1    ^z[2]-1==z[1]^z[2]-1==z[3])
                                        if(a[z[3]-1][x[3]]!=1    ^z[3]-1==z[2]) */
if(z[0]!=0&&z[3]!=0&&z[1]!=0&&z[2]!=0)
        if(a[z[0]-1][x[0]]!=1 || (z[0]>z[1]&&x[0]==x[1]) || (z[0]>z[2]&&x[0]==x[2]) || (z[0]>z[3]&&x[0]==x[3]))
                if(a[z[1]-1][x[1]]!=1||(z[1]>z[0]&&x[1]==x[0]) || (z[1]>z[2]&&x[1]==x[2]) || (z[1]>z[3]&&x[1]==x[3]))
                        if(a[z[2]-1][x[2]]!=1||(z[2]>z[0]&&x[2]==x[0]) || (z[2]>z[1]&&x[2]==x[1]) || (z[2]>z[3]&&x[2]==x[3]))
                                if(a[z[3]-1][x[3]]!=1||(z[3]>z[0]&&x[3]==x[0]) || (z[3]>z[1]&&x[3]==x[1]) || (z[3]>z[2]&&x[3]==x[2]))
            



		{
        for(int i=0;i<4;i++)a[z[i]][x[i]]=0;
        z[0]-=1; z[1]-=1; z[2]-=1; z[3]-=1;
        for(int i=0;i<4;i++)a[z[i]][x[i]]=1;
//FPrint(a,sum);
	}
	break;
        }
 case 32:
 {
 if(z1==1)
        if(x1==1)
        {if(x[0]!=0&&a[z[2]+1][x[2]-1]!=1&&a[z[3]][x[3]-2]!=1)
        {for(int i=0;i<4;i++)a[z[i]][x[i]]=0;
         z[0]+=1;z[1]+=2;z[2]+=1;
         x[0]+=1;        x[2]-=1;x[3]-=2;
         x1=2;}}
        else if(x1==2)
        {if(z[0]!=0&&a[z[2]-1][x[2]]!=1&&a[z[3]-2][x[3]+1]!=1)
        {for(int i=0;i<4;i++)a[z[i]][x[i]]=0;
         z[0]+=1;        z[2]-=1;z[3]-=2;
                 x[1]-=1;        x[3]+=1;
         x1=3;}}
        else if(x1==3)
        {if(x[0]!=11&&a[z[2]][x[2]+1]!=1&&a[z[3]+1][x[3]+2]!=1)
        {for(int i=0;i<4;i++)a[z[i]][x[i]]=0;
                 z[1]-=1;        z[3]+=1;
         x[0]-=1;        x[2]+=1;x[3]+=2;
         x1=4;}}
        else if(x1==4)
        {if(z[1]!=0&&a[z[0]-2][x[0]+1]!=1&&a[z[1]-1][x[1]+2]!=1&&a[z[3]+1][x[3]]!=1)
        {for(int i=0;i<4;i++)a[z[i]][x[i]]=0;
         z[0]-=2;z[1]-=1;        z[3]+=1;
         x[0]+=1;x[1]+=2;x[2]+=1;
         x1=1;}}



 if(z1==2)
        if(x1==1)
        {if(x[1]!=11&&a[z[0]-1][x[0]]!=1&&a[z[1]][x[1]+1]!=1)
        {for(int i=0;i<4;i++)a[z[i]][x[i]]=0;
         z[0]-=1;        z[2]+=1;z[3]+=2;
                 x[1]-=1;        x[3]+=1;
         x1=2;}}
        else if(x1==2)
        {if(z[0]!=0&&a[z[0]-1][x[0]]!=1&&a[z[0]-1][x[0]+1]!=1)
        {for(int i=0;i<4;i++)a[z[i]][x[i]]=0;
         z[0]-=1;z[1]-=2;z[2]-=1;
         x[0]+=1;        x[2]-=1;x[3]-=2;
         x1=3;}}
        else if(x1==3)
        {if(x[0]!=11&&a[z[0]+1][x[0]]!=1&&a[z[0]+1][x[0]+1]!=1&&a[z[0]+2][x[0]+1]!=1)
        {for(int i=0;i<4;i++)a[z[i]][x[i]]=0;
         z[0]+=2;z[1]+=1;        z[3]-=1;
                 x[1]+=1;        x[3]-=1;
         x1=4;}}
        else if(x1==4)
        {if(z[1]!=0&&a[z[0]][x[0]-1]!=1&&a[z[0]][x[0]-2]!=1&&a[z[2]-1][x[2]]!=1)
        {for(int i=0;i<4;i++)a[z[i]][x[i]]=0;
                 z[1]+=1;        z[3]-=1;
         x[0]-=2;x[1]-=1;        x[3]+=1;
         x1=1;}}

 if(z1==3)
        if(x1==1)
        {if(x[0]!=0&&a[z[0]+2][x[0]]!=1&&a[z[0]+2][x[1]-1]!=1)
        {for(int i=0;i<4;i++)a[z[i]][x[i]]=0;
         z[0]+=2;z[1]+=1;        z[3]-=1;
         x[0]-=1;        x[2]-=1;
         x1=2;}}
        else if(x1==2)
        {if(z[3]!=0&&a[z[0]][x[0]+2]!=1&&a[z[0]-2][x[0]+1]!=1)
        {for(int i=0;i<4;i++)a[z[i]][x[i]]=0;
         z[0]-=2;z[1]-=1;        z[3]+=1;
         x[0]+=1;        x[2]+=1;
         x1=1;}}

 if(z1==4)
        if(x1==1)
        {if(x[3]!=0&&a[z[2]][x[2]-1]!=1&&a[z[3]][x[3]+1]!=1)
        {for(int i=0;i<4;i++)a[z[i]][x[i]]=0;
         z[0]+=1;        z[2]+=1;
         x[0]-=2;x[1]-=1;        x[3]+=1;
         x1=2;}}
        else if(x1==2)
        {if(z[0]!=0&&a[z[3]-1][x[3]]!=1&&a[z[3]-2][x[3]]!=1)
        {for(int i=0;i<4;i++)a[z[i]][x[i]]=0;
         z[0]-=1;        z[2]-=1;
         x[0]+=2;x[1]+=1;        x[3]-=1;
         x1=1;}}

 if(z1==6)
        if(x1==1)
        {if(x[3]!=0&&a[z[2]][x[2]-1]!=1&&a[z[2]][x[2]+1]!=1&&a[z[2]][x[2]+2]!=1)
        {for(int i=0;i<4;i++)a[z[i]][x[i]]=0;
         z[0]+=2;z[1]+=1;        z[3]-=1;
         x[0]-=1;        x[2]+=1;x[3]+=2;
         x1=2;}}
        else if(x1==2)
        {if(z[0]!=9&&z[0]!=0&&z[0]-1!=0&&a[z[1]+1][x[1]]!=1&&a[z[1]-1][x[1]]!=1&&a[z[1]-2][x[1]]!=1)
        {for(int i=0;i<4;i++)a[z[i]][x[i]]=0;
         z[0]-=2;z[1]-=1;        z[3]+=1;
         x[0]+=1;        x[2]-=1;x[3]-=2;
         x1=1;}}

 case 80:
 {if(!(x[0]==11||x[3]==11||x[1]==11||x[2]==11
        ||(a[z[0]][x[0]+1]==1 && (x[0]>x[1]||z[0]!=z[1]) && (x[0]>x[2]||z[0]!=z[2]) && (x[0]>x[3]||z[0]!=z[3]))
                ||(a[z[1]][x[1]+1]==1&&(x[1]>x[0]||z[1]!=z[0]) && (x[1]>x[2]||z[1]!=z[2]) && (x[1]>x[3]||z[1]!=z[3]))
                        ||(a[z[2]][x[2]+1]==1&&(x[2]>x[0]||z[2]!=z[0]) && (x[2]>x[1]||z[2]!=z[1]) && (x[2]>x[3]||z[2]!=z[3]))
                                ||(a[z[3]][x[3]+1]==1&&(x[3]>x[0]||z[3]!=z[0]) && (x[3]>x[1]||z[3]!=z[1]) && (x[3]>x[2]||z[3]!=z[2])) ))
                                        {for(int i=0;i<4;i++)a[z[i]][x[i]]=0;x[0]+=1;x[1]+=1;x[2]+=1;x[3]+=1;t=0;}}




        for(int i=0;i<4;i++)a[z[i]][x[i]]=1;
//FPrint(a,sum);
break;

 }




 }





 }
 //GetMessage(&Msg,NULL,0,0);if(Msg.message==WM_TIMER)if(WM_TIMER==1)




/*if(x[0]==11^x[1]==11^x[2]==11^x[3]==11){b=0;s=0;}
else if(x1==1)
        if(a[z[1]][x[1]+1]==1^a[z[2]][x[2]+1]==1^a[z[3]][x[3]+1]==1){b=0;s=0;}
else if(x1==2)
        if(a[z[0]][x[0]+1]==1^a[z[1]][x[1]+1]==1){b=0;s=0;}
else if(x1==3)
        if(a[z[0]][x[0]+1]==1^a[z[2]][x[2]+1]==1^a[z[3]][x[3]+1]==1){b=0;s=0;}
else if(x1==4)
        if(a[z[3]][x[3]+1]==1^a[z[0]][x[0]+1]==1){b=0;s=0;}*/


if(x[0]==11||x[3]==11||x[1]==11||x[2]==11
        ||(a[z[0]][x[0]+1]==1 && (x[0]>x[1]||z[0]!=z[1]) && (x[0]>x[2]||z[0]!=z[2]) && (x[0]>x[3]||z[0]!=z[3]))
                ||(a[z[1]][x[1]+1]==1&&(x[1]>x[0]||z[1]!=z[0]) && (x[1]>x[2]||z[1]!=z[2]) && (x[1]>x[3]||z[1]!=z[3]))
                        ||(a[z[2]][x[2]+1]==1&&(x[2]>x[0]||z[2]!=z[0]) && (x[2]>x[1]||z[2]!=z[1]) && (x[2]>x[3]||z[2]!=z[3]))
                                ||(a[z[3]][x[3]+1]==1&&(x[3]>x[0]||z[3]!=z[0]) && (x[3]>x[1]||z[3]!=z[1]) && (x[3]>x[2]||z[3]!=z[2])) )
                                        {b=0;s=0;
for(int k=0;k<4;k++)
for(int i=11;i>0;i--)
        {
        yk=1;
        for(int j=0;j<10;j++)
            if(a[j][i]==0){yk=0;break;}

        if(yk==1)
        {st++;
                for(int i1=i;i1>0;i1--)
                        for(int j1=0;j1<10;j1++)
                        {a[j1][i1]=a[j1][i1-1];}
        }
        }      }
sum+=10*st*st;
st=0;


if(t==5){for(int i=0;i<4;i++)a[z[i]][x[i]]=0;x[0]+=1;x[1]+=1;x[2]+=1;x[3]+=1;t=0;}





if(s==0&&b!=0)for(int i=0;i<4;i++){a[z[i]][x[i]]=1;s=1;}






}

  getch();

        return 0;
}
//---------------------------------------------------------------------------
 